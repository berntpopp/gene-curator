---
phase: 03-field-metadata
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/dynamic/DynamicField.vue
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Fields display prepend icon when icon property is defined in schema"
    - "Tooltip shows on icon hover when tooltip property is defined"
    - "Persistent hints appear below fields when hint property is defined"
    - "Long hints truncate with show more/less toggle"
    - "Help icon appears and opens external URL when helpUrl is defined"
    - "Fields render correctly when any or all metadata properties are absent"
  artifacts:
    - path: "frontend/src/components/dynamic/DynamicField.vue"
      provides: "Field metadata rendering (icon, hint, tooltip, helpUrl)"
      contains: ["v-tooltip", "prepend-inner", "append-inner", "hintExpanded", "openHelpUrl"]
  key_links:
    - from: "DynamicField template"
      to: "fieldSchema.icon"
      via: "v-slot:prepend-inner conditional rendering"
      pattern: "v-if.*hasIcon"
    - from: "DynamicField template"
      to: "fieldSchema.helpUrl"
      via: "v-slot:append-inner with window.open"
      pattern: "openHelpUrl"
    - from: "DynamicField template"
      to: "fieldSchema.helpUrl"
      via: "v-slot:append-inner with help icon"
      pattern: "v-slot:append-inner.*hasHelpUrl"
    - from: "DynamicField template"
      to: "fieldSchema.hint"
      via: "v-slot:details with truncation toggle"
      pattern: "needsHintTruncation"
---

<objective>
Add field metadata support (icons, hints, tooltips, help links) to DynamicField component.

Purpose: Make form fields self-documenting by displaying contextual help from schema field_definitions, improving usability for complex schemas like ClinGen SOP v11.

Output: DynamicField.vue enhanced with metadata rendering for all basic field types.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-field-metadata/03-CONTEXT.md
@.planning/phases/03-field-metadata/03-RESEARCH.md
@frontend/src/components/dynamic/DynamicField.vue
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add metadata computed properties and helper methods</name>
  <files>frontend/src/components/dynamic/DynamicField.vue</files>
  <action>
Add computed properties and methods for metadata handling to the script section:

1. **Hint Truncation Constant and State:**
   ```javascript
   const HINT_TRUNCATE_LENGTH = 100
   const hintExpanded = ref(false)
   ```

2. **Computed Properties:**
   ```javascript
   // Show icon in prepend slot when icon OR tooltip defined
   const hasIcon = computed(() =>
     props.fieldSchema.icon || props.fieldSchema.tooltip
   )

   // Get icon name, defaulting to info icon when tooltip exists without icon
   const iconName = computed(() =>
     props.fieldSchema.icon || 'mdi-information-outline'
   )

   // Check if hint exists and is non-empty
   const hasHint = computed(() =>
     props.fieldSchema.hint && props.fieldSchema.hint.trim().length > 0
   )

   // Check if hint needs truncation
   const needsHintTruncation = computed(() =>
     hasHint.value && props.fieldSchema.hint.length > HINT_TRUNCATE_LENGTH
   )

   // Get truncated hint text
   const truncatedHint = computed(() =>
     needsHintTruncation.value
       ? props.fieldSchema.hint.substring(0, HINT_TRUNCATE_LENGTH) + '...'
       : props.fieldSchema.hint
   )

   // Check if tooltip exists and is non-empty
   const hasTooltip = computed(() =>
     props.fieldSchema.tooltip && props.fieldSchema.tooltip.trim().length > 0
   )

   // Check if helpUrl exists and is valid URL
   const hasHelpUrl = computed(() =>
     props.fieldSchema.helpUrl &&
     (props.fieldSchema.helpUrl.startsWith('http://') ||
      props.fieldSchema.helpUrl.startsWith('https://'))
   )
   ```

3. **Helper Method:**
   ```javascript
   const openHelpUrl = () => {
     if (!props.fieldSchema.helpUrl) {
       logger.warn('Help URL not defined', { fieldName: props.fieldName })
       return
     }
     window.open(props.fieldSchema.helpUrl, '_blank', 'noopener,noreferrer')
     logger.info('Help documentation opened', {
       fieldName: props.fieldName,
       helpUrl: props.fieldSchema.helpUrl
     })
   }
   ```

Keep existing code. Add these after the existing computed properties and before the methods section.
  </action>
  <verify>
Run: `cd /home/bernt-popp/development/gene-curator/frontend && npm run lint -- src/components/dynamic/DynamicField.vue`
Run: `grep -q "const hasIcon = computed" /home/bernt-popp/development/gene-curator/frontend/src/components/dynamic/DynamicField.vue && echo "hasIcon computed exists"`
Run: `grep -q "const openHelpUrl" /home/bernt-popp/development/gene-curator/frontend/src/components/dynamic/DynamicField.vue && echo "openHelpUrl method exists"`
All three commands should succeed with no lint errors and confirmation output.
  </verify>
  <done>DynamicField has HINT_TRUNCATE_LENGTH constant, hintExpanded ref, hasIcon/iconName/hasHint/needsHintTruncation/truncatedHint/hasTooltip/hasHelpUrl computed properties, and openHelpUrl method.</done>
</task>

<task type="auto">
  <name>Task 2: Add metadata slots to string text-field</name>
  <files>frontend/src/components/dynamic/DynamicField.vue</files>
  <action>
Enhance the v-text-field for string type (the first one, not the one for date) with metadata slots.

1. **Add hint props:**
   ```vue
   :hint="needsHintTruncation ? undefined : fieldSchema.hint"
   :persistent-hint="hasHint && !needsHintTruncation"
   ```

2. **Add prepend-inner slot with icon and tooltip** (inside the v-text-field, after all props):
   ```vue
   <template v-if="hasIcon" #prepend-inner>
     <v-tooltip
       location="top"
       :open-delay="250"
       :disabled="!hasTooltip"
     >
       <template #activator="{ props: tooltipProps }">
         <v-icon
           v-bind="tooltipProps"
           :icon="iconName"
           color="grey-darken-1"
           size="small"
         />
       </template>
       <span>{{ fieldSchema.tooltip }}</span>
     </v-tooltip>
   </template>
   ```

3. **Add append-inner slot with help link** (after prepend-inner):
   ```vue
   <template v-if="hasHelpUrl" #append-inner>
     <v-icon
       icon="mdi-help-circle-outline"
       color="primary"
       size="small"
       style="cursor: pointer;"
       @click.stop="openHelpUrl"
     />
   </template>
   ```

4. **Add details slot for truncated hints** (after append-inner):
   ```vue
   <template v-if="needsHintTruncation" #details>
     <div class="text-caption text-medium-emphasis">
       <span v-if="!hintExpanded">
         {{ truncatedHint }}
         <a
           class="text-primary ml-1"
           style="cursor: pointer;"
           @click.prevent="hintExpanded = true"
         >
           show more
         </a>
       </span>
       <span v-else>
         {{ fieldSchema.hint }}
         <a
           class="text-primary ml-1"
           style="cursor: pointer;"
           @click.prevent="hintExpanded = false"
         >
           show less
         </a>
       </span>
     </div>
   </template>
   ```

The v-text-field should now have slots for prepend-inner, append-inner, and details.
  </action>
  <verify>
Run: `cd /home/bernt-popp/development/gene-curator/frontend && npm run build`
Run: `grep -c "#prepend-inner" /home/bernt-popp/development/gene-curator/frontend/src/components/dynamic/DynamicField.vue`
Run: `grep -c "#append-inner" /home/bernt-popp/development/gene-curator/frontend/src/components/dynamic/DynamicField.vue`
Build should succeed. Grep counts should show at least 1 occurrence each of prepend-inner and append-inner slots.
  </verify>
  <done>String v-text-field has icon with tooltip in prepend-inner, help link in append-inner, and truncatable hint in details slot.</done>
</task>

<task type="auto">
  <name>Task 3: Add metadata to remaining field types</name>
  <files>frontend/src/components/dynamic/DynamicField.vue</files>
  <action>
Apply the same metadata pattern to other field types. Copy the slot template structure from Task 2 to:

1. **v-textarea** (multiline string fields):
   - Add :hint and :persistent-hint props
   - Add #prepend-inner slot with icon/tooltip
   - Add #append-inner slot with help link
   - Add #details slot for truncated hints

2. **v-select** (enum fields):
   - Add :hint and :persistent-hint props
   - Add #prepend-inner slot with icon/tooltip
   - Add #append-inner slot with help link
   - Add #details slot for truncated hints

3. **v-text-field for number/integer**:
   - Add :hint and :persistent-hint props
   - Add #prepend-inner slot with icon/tooltip
   - Add #append-inner slot with help link
   - Add #details slot for truncated hints

4. **v-text-field for date** (format === 'date'):
   - Add :hint and :persistent-hint props
   - Add #prepend-inner slot with icon/tooltip
   - Add #append-inner slot with help link
   - Add #details slot for truncated hints

5. **v-checkbox** (boolean fields):
   v-checkbox does not support prepend-inner/append-inner slots like v-text-field. Use a wrapper div with icons beside the checkbox. v-checkbox uses simple persistent-hint WITHOUT truncation toggle (checkboxes typically have short hints).

For v-checkbox, use this alternative pattern:
```vue
<div v-else-if="fieldSchema.type === 'boolean'" class="d-flex align-center">
  <v-tooltip v-if="hasIcon" location="top" :open-delay="250" :disabled="!hasTooltip">
    <template #activator="{ props: tooltipProps }">
      <v-icon
        v-bind="tooltipProps"
        :icon="iconName"
        color="grey-darken-1"
        size="small"
        class="mr-2"
      />
    </template>
    <span>{{ fieldSchema.tooltip }}</span>
  </v-tooltip>
  <v-checkbox
    :model-value="modelValue"
    :label="getFieldLabel()"
    :rules="getValidationRules()"
    :error-messages="getErrorMessages()"
    :disabled="disabled"
    :hint="fieldSchema.hint"
    :persistent-hint="hasHint"
    hide-details="auto"
    @update:model-value="updateValue"
  />
  <v-icon
    v-if="hasHelpUrl"
    icon="mdi-help-circle-outline"
    color="primary"
    size="small"
    class="ml-2"
    style="cursor: pointer;"
    @click.stop="openHelpUrl"
  />
</div>
```

Note: Boolean fields (checkboxes) use simple persistent-hint without truncation toggle - no show more/less needed for checkboxes as they typically have short hints.

6. **Update existing description display** (line 235-237):
   - Only show if no hint is defined (backward compatibility):
   ```vue
   <div v-if="fieldSchema.description && !fieldSchema.hint" class="text-caption text-medium-emphasis mt-1">
     {{ fieldSchema.description }}
   </div>
   ```
  </action>
  <verify>
Run: `cd /home/bernt-popp/development/gene-curator/frontend && npm run lint && npm run build`
Confirm: All field types compile, no lint errors, build succeeds.
  </verify>
  <done>Textarea, select, number, date, and checkbox fields all support icon, tooltip, hint, and helpUrl metadata properties.</done>
</task>

</tasks>

<verification>
1. **Lint passes:** `cd frontend && npm run lint` shows no errors
2. **Build succeeds:** `cd frontend && npm run build` completes without errors
3. **Existing tests pass:** `cd frontend && npm run test:unit` - all existing tests still pass
4. **Slots present:** grep for `#prepend-inner`, `#append-inner`, `#details` in DynamicField.vue
5. **Tooltip pattern:** grep for `v-tooltip.*open-delay` in DynamicField.vue
6. **Help link security:** grep for `noopener,noreferrer` in DynamicField.vue
7. **Truncation logic:** grep for `HINT_TRUNCATE_LENGTH` and `hintExpanded` in DynamicField.vue
</verification>

<success_criteria>
- DynamicField displays prepend icon when fieldSchema.icon or fieldSchema.tooltip defined
- Tooltip appears on icon hover with 250ms delay when fieldSchema.tooltip defined
- Persistent hint appears below field when fieldSchema.hint defined
- Hints >100 chars truncate with working show more/less toggle
- Help icon in append position links to fieldSchema.helpUrl (opens new tab with noopener noreferrer)
- Icon color is grey-darken-1 for WCAG 4.5:1 contrast compliance
- Fields render correctly with any combination of metadata (all, some, none)
- All existing tests pass
- Lint and build pass
</success_criteria>

<output>
After completion, create `.planning/phases/03-field-metadata/03-01-SUMMARY.md`
</output>
