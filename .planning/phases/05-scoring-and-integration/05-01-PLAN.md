---
phase: 05-scoring-and-integration
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/components/dynamic/ScoreDisplay.vue
  - frontend/src/components/dynamic/DynamicForm.vue
  - frontend/src/composables/useSchemaScoring.js
autonomous: true

must_haves:
  truths:
    - "Score sidebar displays total score and classification for any schema type"
    - "Score values update live as user modifies evidence fields"
    - "Loading state shows skeleton while scores calculate"
    - "Classification chip shows correct color based on thresholds"
  artifacts:
    - path: "frontend/src/components/dynamic/ScoreDisplay.vue"
      provides: "Schema-agnostic score sidebar component"
      min_lines: 150
    - path: "frontend/src/composables/useSchemaScoring.js"
      provides: "Multi-engine scoring composable"
      exports: ["useSchemaScoring"]
  key_links:
    - from: "frontend/src/components/dynamic/DynamicForm.vue"
      to: "ScoreDisplay.vue"
      via: "component import and v-if rendering"
      pattern: "import ScoreDisplay"
    - from: "frontend/src/components/dynamic/ScoreDisplay.vue"
      to: "validationResult.score_calculations"
      via: "props binding"
      pattern: ":score-calculations"
---

<objective>
Create ScoreDisplay component and integrate live scoring into DynamicForm sidebar

Purpose: Enable DynamicForm to display real-time score preview for any schema type (ClinGen, GenCC, Qualitative)
Output: ScoreDisplay.vue component with sticky sidebar integration in DynamicForm
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-scoring-and-integration/05-CONTEXT.md
@.planning/phases/05-scoring-and-integration/05-RESEARCH.md

# Key existing files
@frontend/src/components/dynamic/DynamicForm.vue
@frontend/src/components/evidence/ScorePreview.vue
@frontend/src/composables/useScoring.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create useSchemaScoring composable</name>
  <files>frontend/src/composables/useSchemaScoring.js</files>
  <action>
Create a schema-agnostic scoring composable that works with any scoring engine:

```javascript
/**
 * Schema-agnostic scoring composable
 * Works with ClinGen, GenCC, Qualitative engines
 */
import { computed } from 'vue'

export function useSchemaScoring(scoreCalculations, scoringConfiguration) {
  // Return values needed for ScoreDisplay:
  // - totalScore: computed total from score_calculations
  // - categoryScores: object mapping category names to scores
  // - classification: computed from thresholds
  // - classificationColor: Vuetify color for classification
  // - nearThreshold: boolean if within 1 point of next classification
  // - maxScore: max possible score from scoring config
  // - progressPercentage: totalScore / maxScore * 100
}
```

Key implementation details:
- Accept scoreCalculations ref (from validationResult.score_calculations)
- Accept scoringConfiguration ref (from schema.scoring_configuration)
- Calculate totalScore by summing all values in score_calculations
- Derive classification from classification_thresholds in config
- Color mapping: Definitive/Strong=success, Moderate=info, Limited=warning, None=grey
- Handle null/undefined gracefully (return sensible defaults)
- Support engine-specific max scores (ClinGen=18, GenCC=8, Qualitative=5)

Do NOT use hardcoded engine checks like `if (engine === 'clingen')`. Use the scoring_configuration data dynamically.
  </action>
  <verify>File exists and exports useSchemaScoring function. Run `cd frontend && npm run build` passes.</verify>
  <done>useSchemaScoring composable returns totalScore, categoryScores, classification, classificationColor, nearThreshold for any scoring engine</done>
</task>

<task type="auto">
  <name>Task 2: Create ScoreDisplay component</name>
  <files>frontend/src/components/dynamic/ScoreDisplay.vue</files>
  <action>
Create ScoreDisplay.vue based on patterns from CONTEXT.md and RESEARCH.md:

**Props:**
- scoreCalculations: Object (from validationResult.score_calculations)
- scoringConfiguration: Object (from schema.scoring_configuration)
- loading: Boolean

**Template structure:**
```vue
<template>
  <v-card>
    <v-card-title>
      <v-icon start>mdi-calculator</v-icon>
      Live Scoring
    </v-card-title>
    <v-card-text>
      <!-- Skeleton loader during loading -->
      <v-skeleton-loader v-if="loading" type="list-item-avatar@3" />

      <template v-else>
        <!-- Total score display with progress -->
        <!-- Classification chip with color -->
        <!-- Category breakdown (expandable) -->
        <!-- Threshold reference (collapsed by default) -->
        <!-- Near-threshold indicator when applicable -->
      </template>
    </v-card-text>
  </v-card>
</template>
```

**Key requirements:**
- Use useSchemaScoring composable for all calculations
- 300ms CSS transitions on score value changes per CONTEXT.md
- Default collapsed for threshold panel per CONTEXT.md
- Category icons: mdi-dna for genetic, mdi-flask for experimental, mdi-chart-bar for qualitative
- Format category names: snake_case -> Title Case
- Show "Near threshold" note when within 1 point of next classification
  </action>
  <verify>Component renders without errors. Run `cd frontend && npm run build` passes.</verify>
  <done>ScoreDisplay.vue displays total score, classification chip, category breakdown, and threshold reference panel</done>
</task>

<task type="auto">
  <name>Task 3: Integrate ScoreDisplay into DynamicForm sidebar</name>
  <files>frontend/src/components/dynamic/DynamicForm.vue</files>
  <action>
Modify DynamicForm.vue to show ScoreDisplay in a sticky sidebar:

1. Add import for ScoreDisplay component

2. Add computed property for showing scoring:
```javascript
const showScoring = computed(() => {
  return jsonSchema.value?.scoring_configuration?.engine != null
})
```

3. Wrap existing form content in v-row/v-col layout:
- Main form: cols="12" :lg="showScoring ? 8 : 12"
- Sidebar: cols="12" lg="4" (only when showScoring)

4. Add sticky sidebar with ScoreDisplay:
```vue
<v-col v-if="showScoring" cols="12" lg="4">
  <div class="sticky-sidebar">
    <ScoreDisplay
      :score-calculations="validationResult?.score_calculations"
      :scoring-configuration="jsonSchema?.scoring_configuration"
      :loading="validating"
    />
  </div>
</v-col>
```

5. Add scoped CSS for sticky-sidebar:
```css
.sticky-sidebar {
  position: sticky;
  top: 80px;
  max-height: calc(100vh - 100px);
  overflow-y: auto;
  transition: all 0.3s ease;
}

@media (max-width: 1280px) {
  .sticky-sidebar {
    position: static;
    max-height: none;
  }
}
```

6. Add `validating` ref to track when validation is in progress (set true before validateForm, false after)

7. REMOVE existing inline score display (approximately lines 134-158 - the v-divider, h3 "Live Scoring" header, and v-row with score cards within v-card-text). This entire block is replaced by the new ScoreDisplay sidebar component.

Do NOT break existing tabbed layout structure. The sidebar should be OUTSIDE the v-card, alongside it.
  </action>
  <verify>Run `cd frontend && npm run lint` passes. Load form with scoring schema shows sidebar. Form without scoring shows full-width.</verify>
  <done>DynamicForm shows sticky ScoreDisplay sidebar for schemas with scoring_configuration, full-width layout otherwise</done>
</task>

</tasks>

<verification>
1. Run `cd frontend && npm run build` - should pass
2. Run `cd frontend && npm run lint` - should pass
3. Manual verification: Load a curation form with ClinGen schema, verify score sidebar appears
4. Manual verification: Modify a field value, verify score updates after debounce
</verification>

<success_criteria>
- ScoreDisplay component renders score breakdown for any schema type
- Score updates live as user modifies evidence data (debounced)
- Sticky sidebar on desktop (lg+), static on mobile
- Loading skeleton shows during score calculation
- Classification chip shows correct color based on thresholds
</success_criteria>

<output>
After completion, create `.planning/phases/05-scoring-and-integration/05-01-SUMMARY.md`
</output>
